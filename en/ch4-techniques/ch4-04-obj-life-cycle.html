
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>4.4 Lifecycle control for C++ object - WebAssembly friendly programming with C/C++ - 开源图书(OpenBook)</title>
        
        <meta name="description" content="">
        
        
        <script src="https://cdn.jsdelivr.net/gh/liuxfe/cdn/extra.min.js"></script>
        
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitbook-plugin-theme-default@1.0.7/_assets/website/style.css">

    
            
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="//cdn.jsdelivr.net/npm/gitbook-plugin-theme-default@1.0.7/_assets/website/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="//cdn.jsdelivr.net/npm/gitbook-plugin-theme-default@1.0.7/_assets/website/images/favicon.ico" type="image/x-icon">

    <link rel="next" href="ch4-05-import-js-obj.html" />
    <link rel="prev" href="ch4-03-export-obj.html" />

    </head>
    <body>
        
<div class="book">  
    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
	<a href="/" class="btn pull-left" aria-label="开源图书(OpenBook)"><i class="fa fa-home"></i></a>
    

    <!-- Title -->
    <h1><i class="fa fa-circle-o-notch fa-spin"></i><a href=".." >4.4 Lifecycle control for C++ object</a></h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <ins class="adsbygoogle"
                                     style="display:block"
                                     data-ad-client="ca-pub-9312750344484857"
                                     data-ad-slot="2669241897"
                                     data-ad-format="auto"
                                     data-full-width-responsive="true"></ins>
                                <script>
                                     (adsbygoogle = window.adsbygoogle || []).push({});
                                </script>
                                <section class="normal markdown-section">
                                
                                <h1 id="44-lifecycle-control-for-c-object">4.4 Lifecycle control for C++ object</h1>
<p>C++ does not have a GC mechanism. When a C++ object is exported to JavaScript, it must use some method for object lifecycle management to avoid wild pointers or memory leaks. Reference counting is undoubtedly the most common way.</p>
<h2 id="441-base-class-for-reference-counting">4.4.1 Base class for reference counting</h2>
<p>The problem that object lifecycle management needs to solve is how to decide when to destroy an object when it is referenced in multiple places. Reference counting solves this problem in a simple way:</p>
<ul>
<li>Each object comes with a reference count with an initial value of 0;</li>
<li>Every time when the reference of a object is obtained, increments its reference count by one;</li>
<li>After the object&apos;s user finishes using the object, it does not directly destroy it. Instead, it decrements its reference count by one. When the reference count drops to 0, it means that the object is no longer used and can be safely destroyed.</li>
</ul>
<p>In C++, we generally implement reference counting by adding the <code>AddRef()</code> and <code>Release()</code> member functions to the base class, for example:</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;atomic&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SAFE_RELEASE</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SAFE_RELEASE(p) { <span class="hljs-meta-keyword">if</span>(p) { (p)-&gt;Release(); (p)=NULL; } }</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-keyword">class</span> CRefCount {
<span class="hljs-keyword">public</span>:
    CRefCount() : m_ref_count(<span class="hljs-number">1</span>) {}
    <span class="hljs-keyword">virtual</span> ~CRefCount() {}

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AddRef</span><span class="hljs-params">()</span> </span>{
        m_ref_count++;
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Release</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">int</span> t = --m_ref_count;
        <span class="hljs-keyword">if</span> (t == <span class="hljs-number">0</span>) <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">return</span> t;
    }

<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">std</span>::atomic&lt;<span class="hljs-keyword">int</span>&gt; m_ref_count;
};
</code></pre>
<p>The <code>CRefCount</code> constructor set its reference count member <code>m_ref_count</code> to 1, because when we create an instance of <code>CRefCount</code> we immediately get a reference (pointer) to the object, and the reference count should be 1. The member <code>m_ref_count</code> is of type <code>std::atomic&lt;int&gt;</code>, which guarantees atomic operations under multithreaded conditions and avoids concurrent read and write errors.</p>
<h2 id="442-addrefrelease-usage-rules">4.4.2 <code>AddRef()</code>/<code>Release()</code> usage rules</h2>
<p>The use of <code>AddRef()</code>/<code>Release()</code> generally follows the following rules:</p>
<ol>
<li>When an object&apos;s reference is copied from one memory location to another, <code>AddRef()</code> should be called. When a reference pointed to by a memory location is no longer used, <code>Release()</code> should be called and The memory location should set to <code>null</code>;</li>
<li>If a memory location has previously stored a reference to a non-null object A, when writing another non-null object B into it, the <code>Release()</code> of A should be called first to notify A that it is no longer used, then call B&apos;s <code>AddRef()</code>;</li>
<li>When there is a special convention for the relationship of object references between multiple memory locations, the extra <code>AddRef()</code>/<code>Release()</code> can be omitted.</li>
</ol>
<p>The first and the second are relatively easy to understand, and the more troublesome is the third one, for example:</p>
<pre><code class="lang-cpp">    CRefCount* obj = <span class="hljs-keyword">new</span> CRefCount();

    obj-&gt;AddRef();
    <span class="hljs-comment">//do sth. with obj:</span>
    Func(obj);
    obj-&gt;Release();

    SAFE_RELEASE(obj);
</code></pre>
<p>The <code>AddRef()</code> and <code>Release()</code> around <code>Func(obj)</code> are actually unnecessary, because <code>obj</code> is always valid during the execution of <code>Func(obj)</code>. Another example:</p>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Func</span><span class="hljs-params">(CRefCount* obj)</span> </span>{
    <span class="hljs-keyword">if</span> (!obj) <span class="hljs-keyword">return</span>;

    obj-&gt;AddRef();
    CRefCount* temp = obj;
    <span class="hljs-comment">//do sth. with temp:</span>
    <span class="hljs-comment">//...</span>
    SAFE_RELEASE(temp);
}
</code></pre>
<p><code>obj-&gt;AddRef()</code> and <code>temp-&gt;Release()</code> are also unnecessary, because the lifetime of the local variable <code>temp</code> is consistent with the <code>Func()</code>.</p>
<!--
The reference count increase and decrease rule can be simplified to:
1. For `[in]` objects, if you save it to another location, call `AddRef()`;
1. For `[out]` objects, call `AddRef()`;
1. For `[in out]` objects, first `Release()`, then `AddRef()` after modifying it;
1. If you are not sure, always add `AddRef()`/`Release()`.

The first through the third correspond to the following examples:

1：

```cpp
void Func(CRefCount* obj) {
    //do sth. with obj:
    //...
}
```

2：

```cpp
CRefCount* g_obj = new CRefCount();
CRefCount* GetGlobalObj() {
    g_obj->AddRef();
    return g_obj;
}
```

3：

```cpp
CRefCount* g_obj = new CRefCount();
void UpdateObj(CRefCount*& obj) {
    SAFE_RELEASE(obj);
    g_obj->AddRef();
    obj = g_obj;
}
```-->
<h2 id="443-exporting-addrefrelease">4.4.3 Exporting <code>AddRef()</code>/<code>Release()</code></h2>
<p>According to the introduction in Section 4.3, if all C++ objects inherit from the same <code>CRefCount</code> base class, then you only need to export the <code>AddRef()</code>/<code>Release()</code> of <code>CRefCount</code>. For example:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">//ref_count.cpp</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;atomic&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SAFE_RELEASE</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SAFE_RELEASE(p) { <span class="hljs-meta-keyword">if</span>(p) { (p)-&gt;Release(); (p)=NULL; } }</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-keyword">class</span> CRefCount {
<span class="hljs-keyword">public</span>:
    CRefCount() : m_ref_count(<span class="hljs-number">1</span>) {}
    <span class="hljs-keyword">virtual</span> ~CRefCount() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;CRefCount:~CRefCount()\n&quot;</span>); }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AddRef</span><span class="hljs-params">()</span> </span>{
        m_ref_count++;
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Release</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">int</span> t = --m_ref_count;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;refcount now:%d\n&quot;</span>, t);
        <span class="hljs-keyword">if</span> (t == <span class="hljs-number">0</span>) <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">return</span> t;
    }

<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">std</span>::atomic&lt;<span class="hljs-keyword">int</span>&gt; m_ref_count;
};

<span class="hljs-keyword">struct</span> RefCount;

EM_PORT_API(<span class="hljs-keyword">void</span>) CObj_AddRef(<span class="hljs-keyword">struct</span> RefCount* obj) {
    CRefCount *ro = (CRefCount*)obj;
    ro-&gt;AddRef();
}

EM_PORT_API(<span class="hljs-keyword">int</span>) CObj_Release(<span class="hljs-keyword">struct</span> RefCount* obj) {
    CRefCount *ro = (CRefCount*)obj;
    <span class="hljs-keyword">if</span> (ro) {
        <span class="hljs-keyword">return</span> ro-&gt;Release();
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">//-----------------------------------</span>

<span class="hljs-keyword">class</span> CShape : <span class="hljs-keyword">public</span> CRefCount{
<span class="hljs-keyword">public</span>:
    CShape() {}
    <span class="hljs-keyword">virtual</span> ~CShape() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;CShape:~CShape()\n&quot;</span>); }

    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WhatAreYou</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">struct</span> Shape;

EM_PORT_API(<span class="hljs-keyword">void</span>) Shape_WhatAreYou(<span class="hljs-keyword">struct</span> Shape* shape) {
    CShape *obj = (CShape*)shape;
    obj-&gt;WhatAreYou();
}

<span class="hljs-comment">//-----------------------------------</span>

<span class="hljs-keyword">class</span> CTriangle : <span class="hljs-keyword">public</span> CShape {
<span class="hljs-keyword">public</span>:
    CTriangle() {}
    <span class="hljs-keyword">virtual</span> ~CTriangle() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;CTriangle:~CTriangle()\n&quot;</span>); }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">WhatAreYou</span><span class="hljs-params">()</span></span>{ <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;I&apos;m a triangle.\n&quot;</span>); }
};

EM_PORT_API(<span class="hljs-keyword">struct</span> Shape*) Shape_Create_Triangle() {
    CTriangle *obj = <span class="hljs-keyword">new</span> CTriangle();
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">struct</span> Shape*)obj;
}
</code></pre>
<p>JavaScript code as follows:</p>
<pre><code class="lang-js"><span class="hljs-comment">//ref_count.html</span>
    Module = {};
    <span class="hljs-keyword">var</span> g_t = <span class="hljs-number">0</span>;
    Module.onRuntimeInitialized = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> t = Module._Shape_Create_Triangle();
        Module._Shape_WhatAreYou(t);

        Module._CObj_AddRef(t);
        g_t = t;

        Module._CObj_Release(t);
        t = <span class="hljs-number">0</span>;

        setTimeout(<span class="hljs-string">&quot;Module._CObj_Release(g_t);g_t = 0&quot;</span>, <span class="hljs-number">2000</span>);
    }
</code></pre>
<p>2 seconds after browsing the page, the console will output:</p>
<p><img src="images/04-ref-count-log.png" alt=""></p>
<p>So far, we have completed the export and life cycle control of C++ objects.</p>

                                
                                </section>
                                <ins class="adsbygoogle"
                                     style="display:block"
                                     data-ad-client="ca-pub-9312750344484857"
                                     data-ad-slot="2669241897"
                                     data-ad-format="auto"
                                     data-full-width-responsive="true"></ins>
                                <script>
                                     (adsbygoogle = window.adsbygoogle || []).push({});
                                </script>                                
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ch4-03-export-obj.html" class="navigation navigation-prev " aria-label="上一页: 4.3 Exporting C++ objects using the C interface">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="ch4-05-import-js-obj.html" class="navigation navigation-next " aria-label="下一页: 4.5 Importing JavaScript object using C interface">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            <a href="../">
            
                    
                    Introduction
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../ch1-quick-guide/readme.html">
            <a href="../ch1-quick-guide/readme.html">
            
                    
                    Chapter 1 Getting started with Emscripten
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../ch1-quick-guide/ch1-01-install.html">
            <a href="../ch1-quick-guide/ch1-01-install.html">
            
                    
                    1.1 Installing Emscripten
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../ch1-quick-guide/ch1-02-helloworld.html">
            <a href="../ch1-quick-guide/ch1-02-helloworld.html">
            
                    
                    1.2 Hello, world!
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../ch1-quick-guide/ch1-03-glue-code.html">
            <a href="../ch1-quick-guide/ch1-03-glue-code.html">
            
                    
                    1.3 Taking a look at the Emscripten glue code
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../ch1-quick-guide/ch1-04-compile.html">
            <a href="../ch1-quick-guide/ch1-04-compile.html">
            
                    
                    1.4 Selecting compilation target
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../ch2-c-js/readme.html">
            <a href="../ch2-c-js/readme.html">
            
                    
                    Chapter 2 Connecting C and JavaScript
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../ch2-c-js/ch2-01-js-call-c.html">
            <a href="../ch2-c-js/ch2-01-js-call-c.html">
            
                    
                    2.1 Calling compiled C functions from JavaScript
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../ch2-c-js/ch2-02-implement-c-api-in-js.html">
            <a href="../ch2-c-js/ch2-02-implement-c-api-in-js.html">
            
                    
                    2.2 Implement C API in JavaScript
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../ch2-c-js/ch2-03-mem-model.html">
            <a href="../ch2-c-js/ch2-03-mem-model.html">
            
                    
                    2.3 Memory model
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../ch2-c-js/ch2-04-data-exchange.html">
            <a href="../ch2-c-js/ch2-04-data-exchange.html">
            
                    
                    2.4 Exchange data between C and JavaScript
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../ch2-c-js/ch2-05-em-asm.html">
            <a href="../ch2-c-js/ch2-05-em-asm.html">
            
                    
                    2.5 Using EM_ASM
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../ch2-c-js/ch2-06-run-script.html">
            <a href="../ch2-c-js/ch2-06-run-script.html">
            
                    
                    2.6 Using emscripten_run_script
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../ch2-c-js/ch2-07-ccall-cwrap.html">
            <a href="../ch2-c-js/ch2-07-ccall-cwrap.html">
            
                    
                    2.7 Using ccall/cwrap
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../ch2-c-js/ch2-08-ext.html">
            <a href="../ch2-c-js/ch2-08-ext.html">
            
                    
                    2.8 Supplement
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../ch3-runtime/readme.html">
            <a href="../ch3-runtime/readme.html">
            
                    
                    Chapter 3 Emscripten runtime
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../ch3-runtime/ch3-01-main.html">
            <a href="../ch3-runtime/ch3-01-main.html">
            
                    
                    3.1 Runtime lifecycle
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../ch3-runtime/ch3-02-message-loop.html">
            <a href="../ch3-runtime/ch3-02-message-loop.html">
            
                    
                    3.2 Message loop
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../ch3-runtime/ch3-03-fs.html">
            <a href="../ch3-runtime/ch3-03-fs.html">
            
                    
                    3.3 File system
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../ch3-runtime/ch3-04-mem.html">
            <a href="../ch3-runtime/ch3-04-mem.html">
            
                    
                    3.4 Memory management
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../ch3-runtime/ch3-05-module.html">
            <a href="../ch3-runtime/ch3-05-module.html">
            
                    
                    3.5 Customize Module object
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../ch3-runtime/ch3-06-summary.html">
            <a href="../ch3-runtime/ch3-06-summary.html">
            
                    
                    3.6 Summary
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="readme.html">
            <a href="readme.html">
            
                    
                    Chapter 4 General techniques that WebAssembly friendly
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="ch4-01-msg-loop-detach.html">
            <a href="ch4-01-msg-loop-detach.html">
            
                    
                    4.1 Message loop detaching
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="ch4-02-align.html">
            <a href="ch4-02-align.html">
            
                    
                    4.2 Memory alignment
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="ch4-03-export-obj.html">
            <a href="ch4-03-export-obj.html">
            
                    
                    4.3 Exporting C++ objects using the C interface
            </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.4" data-path="ch4-04-obj-life-cycle.html">
            <a href="ch4-04-obj-life-cycle.html">
            
                    
                    4.4 Lifecycle control for C++ object
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="ch4-05-import-js-obj.html">
            <a href="ch4-05-import-js-obj.html">
            
                    
                    4.5 Importing JavaScript object using C interface
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="ch4-06-int64-issue.html">
            <a href="ch4-06-int64-issue.html">
            
                    
                    4.6 Be careful with int64
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="ch4-07-forget-about-fs.html">
            <a href="ch4-07-forget-about-fs.html">
            
                    
                    4.7 Forget about filesystem
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../ch5-net/readme.html">
            <a href="../ch5-net/readme.html">
            
                    
                    Chapter 5 Network IO
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../ch5-net/ch5-01-http.html">
            <a href="../ch5-net/ch5-01-http.html">
            
                    
                    5.1 XMLHttpRequest
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../ch5-net/ch5-02-websocket.html">
            <a href="../ch5-net/ch5-02-websocket.html">
            
                    
                    5.2 WebSocket
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../ch6-threads/readme.html">
            <a href="../ch6-threads/readme.html">
            
                    
                    Chapter 6 Multithreading
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../ch6-threads/ch6-01-worker.html">
            <a href="../ch6-threads/ch6-01-worker.html">
            
                    
                    6.1 Multithreading in JavaScript
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../ch6-threads/ch6-02-sample.html">
            <a href="../ch6-threads/ch6-02-sample.html">
            
                    
                    6.2 Using Emscripten in Web Worker
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../ch7-gui/readme.html">
            <a href="../ch7-gui/readme.html">
            
                    
                    Chapter 7 GUI
            </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../ch7-gui/ch7-01-canvas.html">
            <a href="../ch7-gui/ch7-01-canvas.html">
            
                    
                    7.1 Canvas
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../ch7-gui/ch7-02-mouse.html">
            <a href="../ch7-gui/ch7-02-mouse.html">
            
                    
                    7.2 Mouse events
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../ch7-gui/ch7-03-keyboard.html">
            <a href="../ch7-gui/ch7-03-keyboard.html">
            
                    
                    7.3 Keyboard events
            </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../ch7-gui/ch7-04-life.html">
            <a href="../ch7-gui/ch7-04-life.html">
            
                    
                    7.4 Conway's Game of Life
            </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://openbook.liuxfe.com" target="_blank" class="gitbook-link"><strong>开源图书(OpenBook)</strong></a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"4.4 Lifecycle control for C++ object","level":"1.5.4","depth":2,"next":{"title":"4.5 Importing JavaScript object using C interface","level":"1.5.5","depth":2,"path":"ch4-techniques/ch4-05-import-js-obj.md","ref":"ch4-techniques/ch4-05-import-js-obj.md","articles":[]},"previous":{"title":"4.3 Exporting C++ objects using the C interface","level":"1.5.3","depth":2,"path":"ch4-techniques/ch4-03-export-obj.md","ref":"ch4-techniques/ch4-03-export-obj.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-openbook":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"preface.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"WebAssembly friendly programming with C/C++","language":"en","gitbook":"3.x","description":"WebAssembly friendly programming with C/C++ -- Emscripten practice"},"file":{"path":"ch4-techniques/ch4-04-obj-life-cycle.md","mtime":"2021-03-24T09:27:31.451Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-03-24T09:28:10.200Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="//cdn.jsdelivr.net/npm/gitbook-plugin-theme-default@1.0.7/_assets/website/gitbook.js"></script>
    <script src="//cdn.jsdelivr.net/npm/gitbook-plugin-theme-default@1.0.7/_assets/website/theme.js"></script>
    
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

